# Fingerprint_Database_Generator
The MITMEngine project (https://github.com/cloudflare/mitmengine) detects HTTPS interception and user agent spoofing by checking if the TLS fingerprint of an incoming connection corresponds to the expected fingerprint for the connectionâ€™s user agent. MITMEngine powers the MALCOLM dashboard (https://malcolm.cloudflare.com). The goal of this project is to use BrowserStack to generate TLS client hello fingerprints and user agents for a selection of recent browsers and store them in a Postgres database.


## Steps

#### MacOS

1- Install version 12.3 postgresql on Mac using: https://www.robinwieruch.de/postgres-sql-macos-setup;  you can run "brew install postgresql"

2- Create postgresql database with a table listing the http fingerprints, a table listing the tls fingerprints and a third table storing the matching of their respective ids (run script ). 
 
  
#### Ubuntu
 
1- Install version 12.3 postgresql on Ubuntu using: https://www.postgresql.org/docs/9.0/tutorial-install.html
  * In case you get the error `createdb: could not connect to database template1: FATAL:  Peer authentication failed for user "postgres"`,  
     * run `sudo nano /etc/postgresql/10/main/pg_hba.conf` and 
     * replace `local   all             postgres                                peer` by `local   all             postgres                                trust`
     * `sudo /etc/init.d/postgresql reload 


3- Create an account on BrowserStack (a free account would be enough for this project); automate browserstack for python using https://www.browserstack.com/automate/python. 
  * install behave-browserstack (https://github.com/browserstack/behave-browserstack.git) -- not sure this is compulsory
  
4- Download and install mitmengine 
  * setup Go (https://golang.org/dl/go1.14.4.linux-amd64.tar.gz) using https://golang.org/doc/install
  * install and run vendering or gomo logic using https://gocodecloud.com/blog/2016/03/29/go-vendoring-beginner-tutorial/ --not sure
  * Use Go 1.14.1 (go version go1.14.4 linux/amd64 for linux and go1.14.4 darwin/amd64 for macOS). In case you needed to uninstall Go, use https://stackoverflow.com/questions/42186003/how-to-uninstall-golang
  * set GOPATH to /home/username/go/
  * run ``make test`` and ``make cover`` in ```/home/username/go/src/github.com/cloudflare/mitmengine```
 
5- HTTPS vs TLS signatures

Q1:

generated by github.com/cloudflare/mitmengine/scripts/gen_mitm_records.sh
* Is this the format of an HTTPS fingerprint?  
<browser_name>:<browser_version>:<os_platform>:<os_name>:<os_version>:<device_type>:<quirks>|<tls_version>:<cipher_suites>:<extension_names>:<curves>:<ec_point_fmts>:<http_headers>:<quirks>|<mitm_name>:<mitm_type>:<mitm_grade>


* Is this the format of a TLS fingerprint? What is the template i.e what is it composed of?
- https://jhalderm.com/pub/papers/interception-ndss17.pdf

- https://github.com/zakird/tlsfingerprints/blob/master/processing/browsers/browser.py#L131

0::0:0::0:|:*:*:*:*:*barracuda:*|Barracuda:5:0

0::0:0::0:|:*:*:*:*:*cuda_cliip:*|Barracuda:5:0

0::0:0::0:|:*:*:*:*:*gdata-version:*|GData:1:4



## Writeup on design choices

1- By running,  `curl -u "username:key" https://api.browserstack.com/automate/browsers.json > browsers_infos.json`, we get a list of desired capabilities for both desktop and mobile browsers using the command below. It returns a flat hash in the format [:os, :os_version, :browser, :browser_version, :device, :real_mobile].
We could use the results to build the HTTPS fingerprints of all devices. 



